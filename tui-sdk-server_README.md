# TUI Uses the OpenCode Go SDK

The TUI does use the OpenCode Go SDK. Below is a cleaned and structured overview of how the pieces fit together, with responsibilities and key points called out.

## Complete Flow

```text
┌─────────────────────────────────────────────────────┐
│ tui.ts (TypeScript)                                 │
│ packages/opencode/src/cli/cmd/tui.ts                │
├─────────────────────────────────────────────────────┤
│ 1. Starts OpenCode Server (HTTP API)                │
│    Server.listen({ port, hostname })                │
│                                                     │
│ 2. Launches TUI Go binary                           │
│    Bun.spawn([binary, ...args], {                   │
│      env: {                                         │
│        OPENCODE_SERVER: "http://127.0.0.1:<port>"  │
│      }                                              │
│    })                                               │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│ TUI (Go) - packages/tui/cmd/opencode/main.go        │
├─────────────────────────────────────────────────────┤
│ 1. Reads OPENCODE_SERVER env variable (≈ line 40)   │
│                                                     │
│ 2. Creates SDK client (≈ lines 71–73):              │
│    httpClient := opencode.NewClient(                │
│      option.WithBaseURL(url)                        │
│    )                                                │
│                                                     │
│ 3. Makes API calls via SDK (≈ lines 82–106):        │
│    - httpClient.Project.Current()                   │
│    - httpClient.Agent.List()                        │
│    - httpClient.Path.Get()                          │
│    - httpClient.Event.ListStreaming() (≈ line 146)  │
│                                                     │
│ 4. Renders UI with Bubble Tea                       │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│ OpenCode Go SDK - packages/sdk/go/                  │
│ (Auto-generated by Stainless)                       │
├─────────────────────────────────────────────────────┤
│ Provides typed Go interface:                        │
│ - client.Project.Current()                          │
│ - client.Agent.List()                               │
│ - client.Session.Create()                           │
│ - client.Event.ListStreaming()                      │
│                                                     │
│ → Makes HTTP requests to OpenCode Server            │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│ OpenCode Server (TypeScript/Bun)                    │
│ packages/opencode/src/server/                       │
├─────────────────────────────────────────────────────┤
│ HTTP API (Hono framework):                          │
│ - /api/project/current                              │
│ - /api/agent/list                                   │
│ - /api/session/*                                    │
│ - /api/event/stream (SSE)                           │
│                                                     │
│ Business Logic:                                     │
│ - Agent system (AI orchestration)                   │
│ - Tool execution (Bash, Edit, Read, Write)          │
│ - Session management                                │
│ - Provider integration (Anthropic, OpenAI, etc.)    │
└─────────────────────────────────────────────────────┘
```

## File Responsibilities

### TypeScript Side
- `packages/opencode/src/cli/cmd/tui.ts`: Launches TUI and orchestrates the server
- `packages/opencode/src/server/server.ts`: HTTP/WebSocket server (Hono)
- `packages/opencode/src/agent/`: AI agent logic
- `packages/opencode/src/tool/`: File operations and bash execution
- `packages/opencode/src/session/`: Session persistence

### Go SDK
- `packages/sdk/go/`: Auto-generated HTTP client library
  - Used by the TUI to communicate with the server
  - Provides a type-safe Go API
  - Generated from the OpenAPI spec using Stainless

### Go TUI
- `packages/tui/cmd/opencode/main.go`: Entry point (creates SDK client around line 71)
- `packages/tui/internal/api/api.go`: API communication layer (uses SDK around line 9)
- `packages/tui/internal/tui/`: Bubble Tea UI components
- `packages/tui/internal/app/`: Application state

## Key Points
1. The TUI uses the Go SDK (in `main.go` it imports `github.com/sst/opencode-sdk-go`).
2. The SDK is auto-generated from the server's OpenAPI spec (via Stainless).
3. The SDK wraps HTTP calls, providing a typed interface instead of raw HTTP.
4. The server URL is passed via the `OPENCODE_SERVER` environment variable.

You were absolutely right that the TUI uses the SDK.